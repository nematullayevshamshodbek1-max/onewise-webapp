<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>1WISE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#050b16;
      --card:#0b1426;
      --stroke: rgba(255,255,255,.08);
      --text:#ffffff;
      --muted: rgba(255,255,255,.78);
      --blue:#2F80ED;
      --btn2:#1a2540;
    }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 50% -10%, rgba(47,128,237,.18), transparent 60%), var(--bg);
      color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:18px;
    }
    .app{width:100%; max-width:420px;}
    .logo{
      text-align:center;
      font-size:32px;
      font-weight:900;
      letter-spacing:.6px;
      margin-bottom:16px;
    }
    .logo span{color:var(--blue)}
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
    }
    .banner{
      background: linear-gradient(135deg, rgba(47,128,237,0.25), rgba(255,255,255,0.03));
      border-radius: 14px;
      padding: 14px;
      font-size: 14px;
      line-height: 1.35;
    }
    .user{
      font-size: 14px;
      color: var(--muted);
      white-space: pre-line;
      line-height: 1.35;
    }
    button{
      width:100%;
      border:none;
      border-radius: 14px;
      padding: 14px;
      font-size: 16px;
      font-weight: 800;
      cursor:pointer;
    }
    .primary{background: var(--blue); color:#fff; margin-bottom:10px;}
    .secondary{background: var(--btn2); color:#fff; border:1px solid var(--stroke);}
    .status{
      margin-top:12px;
      font-size: 14px;
      white-space: pre-line;
      display:none;
      color: var(--muted);
      border-top: 1px solid var(--stroke);
      padding-top: 12px;
    }
    .small{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      line-height: 1.35;
      text-align:center;
    }

    /* Language modal */
    #langModal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    #langBox{
      width:100%;
      max-width:420px;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.38);
    }
    #langTitle{
      font-weight:900;
      font-size:16px;
      margin-bottom:10px;
    }
    .langBtn{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background:#111c35;
      color:#fff;
      font-weight:800;
      margin-top:10px;
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="logo"><span>1</span>WISE</div>

    <div class="card banner" id="bannerText">
      üéâ <b>7 DAYS FREE</b><br>
      Opening week ‚Äî free IQ duels, earn points and rank up.
    </div>

    <div class="card">
      <div id="userInfo" class="user">Loading...</div>
    </div>

    <div class="card">
      <button id="startBtn" class="primary">‚öîÔ∏è Start Duel</button>
      <button id="rulesBtn" class="secondary">üìÑ Rules</button>
      <div id="status" class="status"></div>
    </div>

    <div class="small">
      Privacy: we only use your Telegram ID to create your profile.
    </div>
  </div>

  <!-- Language Modal -->
  <div id="langModal">
    <div id="langBox">
      <div id="langTitle">Choose language</div>
      <button class="langBtn" id="langEN">üá¨üáß English</button>
      <button class="langBtn" id="langUZ">üá∫üáø O‚Äòzbekcha</button>
      <button class="langBtn" id="langRU">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const user = tg.initDataUnsafe?.user;

    // ====== strings ======
    const STR = {
      en: {
        banner: "üéâ <b>7 DAYS FREE</b><br>Opening week ‚Äî free IQ duels, earn points and rank up.",
        welcome: (name) => `Welcome, ${name}`,
        outside: "Opened outside Telegram",
        start: "Searching for opponent...\n(Demo mode)",
        needTG: "Please open via @onewise_bot",
        rules:
          "Rules:\n" +
          "‚Ä¢ 1 vs 1 IQ duel\n" +
          "‚Ä¢ 10 questions\n" +
          "‚Ä¢ Fast & correct wins\n" +
          "‚Ä¢ Daily leaderboard resets 00:00"
      },
      uz: {
        banner: "üéâ <b>7 KUN TEKIN</b><br>Ochilish haftasi ‚Äî tekin IQ duellar, ball to‚Äòplang va reytingga chiqing.",
        welcome: (name) => `Xush kelibsiz, ${name}`,
        outside: "Telegram orqali oching",
        start: "Raqib qidirilmoqda...\n(Demo rejim)",
        needTG: "Iltimos, @onewise_bot orqali oching",
        rules:
          "Qoidalar:\n" +
          "‚Ä¢ 1 vs 1 IQ duel\n" +
          "‚Ä¢ 10 ta savol\n" +
          "‚Ä¢ Tez va to‚Äòg‚Äòri yutadi\n" +
          "‚Ä¢ Reyting har kuni 00:00 da yangilanadi"
      },
      ru: {
        banner: "üéâ <b>7 –î–ù–ï–ô –ë–ï–°–ü–õ–ê–¢–ù–û</b><br>–û—Ç–∫—Ä—ã—Ç–∏–µ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ IQ-–¥—É—ç–ª–∏, –Ω–∞–±–∏—Ä–∞–π—Ç–µ –æ—á–∫–∏ –∏ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ.",
        welcome: (name) => `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}`,
        outside: "–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram",
        start: "–ò—â–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...\n(–î–µ–º–æ —Ä–µ–∂–∏–º)",
        needTG: "–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ @onewise_bot",
        rules:
          "–ü—Ä–∞–≤–∏–ª–∞:\n" +
          "‚Ä¢ 1 vs 1 IQ –¥—É—ç–ª—å\n" +
          "‚Ä¢ 10 –≤–æ–ø—Ä–æ—Å–æ–≤\n" +
          "‚Ä¢ –ë—ã—Å—Ç—Ä–µ–µ –∏ —Ç–æ—á–Ω–µ–µ ‚Äî –ø–æ–±–µ–¥–∞\n" +
          "‚Ä¢ –†–µ–π—Ç–∏–Ω–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 00:00"
      }
    };

    // Default is ALWAYS English (global)
    let lang = localStorage.getItem("onewise_lang") || "en";

    const bannerEl = document.getElementById("bannerText");
    const userInfo = document.getElementById("userInfo");
    const statusBox = document.getElementById("status");

    const startBtn = document.getElementById("startBtn");
    const rulesBtn = document.getElementById("rulesBtn");

    const langModal = document.getElementById("langModal");
    const langEN = document.getElementById("langEN");
    const langUZ = document.getElementById("langUZ");
    const langRU = document.getElementById("langRU");

    function showStatus(text){
      statusBox.style.display = "block";
      statusBox.textContent = text;
    }

    function applyLang(){
      const s = STR[lang];

      // banner uses innerHTML for <b> + <br>
      bannerEl.innerHTML = s.banner;

      if (user) userInfo.textContent = s.welcome(user.first_name);
      else userInfo.textContent = s.outside;
    }

    function openLangModal(){
      // Title always English (global)
      document.getElementById("langTitle").textContent = "Choose language";
      langModal.style.display = "flex";
    }

    function setLang(newLang){
      lang = newLang;
      localStorage.setItem("onewise_lang", lang);
      langModal.style.display = "none";
      applyLang();
    }

    langEN.onclick = () => setLang("en");
    langUZ.onclick = () => setLang("uz");
    langRU.onclick = () => setLang("ru");

    // show once, first entry
    if (!localStorage.getItem("onewise_lang")) openLangModal();

    // apply now
    applyLang();

    // buttons (demo)
    startBtn.onclick = () => {
      const s = STR[lang];
      if (!user) return showStatus(s.needTG);
      showStatus(s.start);
    };

    rulesBtn.onclick = () => {
      showStatus(STR[lang].rules);
    };
    // register user to backend (once)
if (user) {
  fetch("http://localhost:3000/api/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      telegram_id: String(user.id),
      first_name: user.first_name
    })
  }).catch(() => {});
}

  </script>
</body>
</html>

